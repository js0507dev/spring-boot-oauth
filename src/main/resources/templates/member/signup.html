<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <title>Signup</title>
  <link rel="stylesheet" type="text/css" href="webjars/bootstrap/3.3.7/css/bootstrap.min.css"/>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <style type="text/css">
    table th {width:100px; padding:3px 5px;}
    table td {padding:3px 5px;}
    table td input {width:200px;}
  </style>
</head>
<body>
<script>
  function checkid() {
    let id = document.getElementById("uid").value;
    let msg = document.getElementById("uid_msg")
    const match = /^[a-zA-Z]{1}(\w{3,15})$/;
    if(!match.exec(id)) {
      msg.innerHTML = "아이디는 영문자로 시작하는 4~16자리의 영문 대,소문자, 숫자, _로 구성되어야 합니다.";
      return false;
    }
    msg.innerHTML = '';
    return true;
  }

  function checkpwd() {
    /*<![CDATA[*/
    let pwd = document.getElementById("password").value;
    let pwd2 = document.getElementById("repassword").value;
    let msg = document.getElementById("password_msg")
    const match = /^(?=.*\d)(?=.*[a-zA-Z])(?=.*[!@#$%^&* ?.,/])[\w!@#$%^&* ?,./]{8,}$/;
    if(!match.exec(pwd)) {
      msg.innerHTML = "비밀번호는 영문,숫자,특수문자를 각 1개씩 포함하는 8자리 이상 문자로 구성되어야 합니다.";
      return false;
    }
    else if (pwd != pwd2) {
      msg.innerHTML = "비밀번호가 동일하지 않습니다.";
      return false;
    }
    msg.innerHTML = '';
    /*]]>*/
    return true;
  }

  function checkname() {
    /*<![CDATA[*/
    let name = document.getElementById("name").value;
    let msg = document.getElementById("name_msg");
    if(name == null || name.length < 1) {
      msg.innerHTML = "이름을 입력해주세요!";
      return false;
    }
    msg.innerHTML = '';
    /*]]>*/
    return true;
  }

  function onSignup() {
    /*<![CDATA[*/
    let chk = checkid() & checkpwd() & checkname();
    /*]]>*/
    if (chk) {
      let id = document.getElementById("uid").value;
      let password = document.getElementById("password").value;
      let name = document.getElementById("name").value;
      let email = document.getElementById("email").value;
      axios.post('/member/' + id, {
        uid: id,
        password: password,
        name: name,
        email: email
      })
      .then(function(response) {
        alert("회원가입 되었습니다.");
        self.close();
      })
      .catch(function(error) {
        alert(error);
      })
    } else {
      console.log('테스트실패!');
    }
  }
</script>
<div class="container">
  <div class="starter-template">
    <h1>회원가입</h1>
    <form name="signup_form">
      <table>
        <tr>
          <th><label for="uid"><span>아이디</span></label></th>
          <td>
            <input type="text" id="uid" name="uid" onblur="checkid();"/>
          </td>
          <td>
            <span id="uid_msg" style="font-weight:bold; color:red;"></span>
          </td>
        </tr>
        <tr>
          <th><label for="name"><span>이름</span></label></th>
          <td>
            <input type="text" id="name" name="name" onblur="checkname();"/>
          </td>
          <td>
            <span id="name_msg" style="font-weight:bold; color:red;"></span>
          </td>
        </tr>
        <tr>
          <th><label for="password"><span>비밀번호</span></label></th>
          <td>
            <input type="password" id="password" name="password" onblur="checkpwd();"/>
          </td>
          <td rowspan="2">
            <span id="password_msg" style="font-weight:bold; color:red;"></span>
          </td>
        </tr>
        <tr>
          <th><label for="repassword"><span>비밀번호 확인</span></label></th>
          <td>
            <input type="password" id="repassword" name="repassword" onblur="checkpwd();"/>
          </td>
        </tr>
        <tr>
          <th><label for="email"><span>이메일주소</span></label></th>
          <td>
            <input type="email" id="email" name="email" onblur=""/>
          </td>
          <td>
            <span id="email_msg" style="font-weight:bold; color:red;"></span>
          </td>
        </tr>
        <tr>
          <td colspan="3">
            <button onclick="onSignup(); return false;">회원가입</button>
          </td>
        </tr>
      </table>
    </form>
  </div>
</div>
<!-- /.container -->
</body>
</html>